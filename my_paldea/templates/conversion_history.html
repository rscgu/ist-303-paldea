{% extends 'base.html' %}
{% block container %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-12">
            <h2>Currency Conversion History</h2>
            <a href="{{ url_for('paldea_app.currency_settings') }}" class="btn btn-secondary mb-3">‚Üê Back to Currency Settings</a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5>All Conversions</h5>
                </div>
                <div class="card-body">
                    {% if conversions.items %}
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Date & Time</th>
                                    <th>From Currency</th>
                                    <th>To Currency</th>
                                    <th>Amount</th>
                                    <th>Converted Amount</th>
                                    <th>Exchange Rate</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for conversion in conversions.items %}
                                <tr>
                                    <td>{{ conversion.date.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                                    <td>
                                        <strong>{{ conversion.from_currency.code }}</strong>
                                        <span class="text-muted">({{ conversion.from_currency.symbol }})</span>
                                    </td>
                                    <td>
                                        <strong>{{ conversion.to_currency.code }}</strong>
                                        <span class="text-muted">({{ conversion.to_currency.symbol }})</span>
                                    </td>
                                    <td>{{ "%.2f"|format(conversion.amount) }} {{ conversion.from_currency.symbol }}</td>
                                    <td><strong>{{ "%.2f"|format(conversion.converted_amount) }} {{ conversion.to_currency.symbol }}</strong></td>
                                    <td>{{ "%.6f"|format(conversion.rate) }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-center">
                            {% if conversions.has_prev %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('paldea_app.conversion_history', page=conversions.prev_num) }}">Previous</a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">Previous</span>
                            </li>
                            {% endif %}
                            
                            {% for page_num in conversions.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                                {% if page_num %}
                                    {% if page_num == conversions.page %}
                                    <li class="page-item active">
                                        <span class="page-link">{{ page_num }}</span>
                                    </li>
                                    {% else %}
                                    <li class="page-item">
                                        <a class="page-link" href="{{ url_for('paldea_app.conversion_history', page=page_num) }}">{{ page_num }}</a>
                                    </li>
                                    {% endif %}
                                {% else %}
                                    <li class="page-item disabled">
                                        <span class="page-link">...</span>
                                    </li>
                                {% endif %}
                            {% endfor %}
                            
                            {% if conversions.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('paldea_app.conversion_history', page=conversions.next_num) }}">Next</a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">Next</span>
                            </li>
                            {% endif %}
                        </ul>
                    </nav>

                    <p class="text-muted text-center mt-3">
                        Showing {{ conversions.per_page * (conversions.page - 1) + 1 }} to 
                        {{ conversions.per_page * (conversions.page - 1) + conversions.items|length }} 
                        of {{ conversions.total }} conversions
                    </p>
                    {% else %}
                    <p class="text-muted">No conversion history found.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

